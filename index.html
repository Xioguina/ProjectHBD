<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>TO livia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
body {
  background: #0f0f0f;
  color: #f9f9f9;
  font-family: 'Noto Serif TC', serif;
  margin: 0;
}

/* é€šç”¨æŒ‰éˆ•æ¨£å¼ */
.next-intro-btn {
    display: block;
    margin: 2rem auto; /* â¬…ï¸ é€™æ˜¯é‡é»ï¼šè®“å®ƒæ°´å¹³ç½®ä¸­ */
     margin-left: auto;
  margin-right: auto;
  position: relative;
  min-width: 200px;
  border: 0;
  border-radius: 0.25rem;
  background-color: #6200ee;
  color: #ffffff;
  font-size: 1rem;
  font-weight: bold;
  text-align: center;
  text-decoration: none;
  text-transform: uppercase;
  overflow: hidden;
  transition: background-color 400ms ease-in-out;
  padding: 10px 20px;
  box-shadow: 0 0 0.5rem rgba(0, 0, 0, 0.3);
  cursor: pointer;
}
.next-intro-btn:hover { background-color: #6e08ff; }
.next-intro-btn .ripple {
  position: absolute;
  border-radius: 50%;
  transform: scale(0);
  animation: ripple-animation 600ms ease-out;
  background-color: rgba(255, 255, 255, 0.7);
  user-select: none;
  pointer-events: none;
}
@keyframes ripple-animation {
  to { transform: scale(4); opacity: 0; }
}


/* æ®µè½1ï¼šæ—¥æœŸè¼¸å…¥ç•«é¢ */
.cover-check {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  background: #0f0f0f;
  padding: 0 4vw;
}
.cover-check h2 {
  font-size: 2.2rem;
  font-weight: bold;
  margin-bottom: 2rem;
  color: #fff;
  text-align: center;
  letter-spacing: 0.05em;
  text-shadow: 0 2px 10px #000;
}
.date-inputs {
  display: flex;
  gap: 1.2rem;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  margin-top: 1rem;
  margin-bottom: 1.5rem;
}
.date-inputs input {
  width: 80px;
  padding: 0.8rem;
  font-size: 1.1rem;
  border-radius: 8px;
  border: none;
  background: #222;
  color: #fff;
  text-align: center;
  outline: none;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  transition: border 0.2s;
}
#date-confirm-btn {
  padding: 0.8rem 2.2rem;
  font-size: 1.1rem;
  border-radius: 8px;
  border: none;
  background: #6200ee;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 2px 10px rgba(0,0,0,0.07);
  transition: background 0.2s;
  margin: 0 auto;
  display: block;
}
#date-confirm-btn:hover {
  background: #6e08ff;
}
@media (max-width: 600px) {
  .date-inputs {
    flex-direction: column;
    gap: 0.7rem;
  }
  .cover-check h2 {
    font-size: 1.3rem;
  }
  .date-inputs input {
    width: 60vw;
    max-width: 120px;
    font-size: 1rem;
  }
  #date-confirm-btn {
    width: 100%;
    min-width: 110px;
    font-size: 1rem;
  }
}

/* æ®µè½2ï¼šæ‰“å­—å‹•ç•« */
#intro {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  min-height: 60vh;
}

.typewriter {
  /* é ç•™é«˜åº¦ï¼Œè®“æŒ‰éˆ•å›ºå®šä½ç½®ä¸è¢«æ¨å‹• */
  min-height: 12em;
  font-size: 2vw;
  font-style: italic;
  text-align: center;
  max-width: 90vw;
}

.type-line {
  display: block;
  overflow: hidden;
  margin: 0;
}

.caret {
  display: inline-block;
  font-size: 1.5em;
  animation: blink .8s infinite;
  margin-left: 4px;
}

@keyframes blink {
  0%,100% { opacity: 1 }
  50% { opacity: 0 }
}
/* æ®µè½3ï¼šè‚–åƒå¡èˆ‡ AKA åˆ—è¡¨ */
.portrait-card {
  background: rgba(255,255,255,0.15);
  border-radius: 18px;
  box-shadow: 0 6px 24px rgba(0,0,0,0.20), 0 1.5px 6px rgba(0,0,0,0.06);
  max-width: 68vw;
  margin: 0 auto 0 auto;
  padding: 6vw 3vw 3vw 3vw;
  display: flex;
  justify-content: center;
  align-items: center;
  backdrop-filter: blur(2px);
}
.portrait-card img {
  width: 150vw; max-width: 350px;
  height: 100vw; max-height:400px;
  border-radius: 12px; 
  object-fit: cover;
  box-shadow: 0 2px 12px rgba(0,0,0,0.14);
  border: 2.5px solid #f9f9f9;
  background: #f3f3f3;
}
.aka {
  opacity: 0; transform: translateY(20px);
  font-size: 3vw; line-height: 1.6;
  transition: opacity .8s, transform .8s;
  text-align: center;
}
.aka.visible { opacity: 1; transform: translateY(0); }
#portrait { min-height: 90vh; padding-bottom: 12vw; }

/* æ®µè½4ï¼šTinder å¡ç‰‡å€ */
.swipe-area {
  position: relative;
  width: 92vw; max-width: 340px;
  height: 100vw; max-height: 440px;
  margin: 0 auto;
}
.card {
  position: absolute;
  width: 100%; height: 100%;
  background: #222; border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.6);
  touch-action: none; user-select: none;
  transition: transform .3s, opacity .3s;
  display: flex; flex-direction: column;
}
.profile-info {
  padding: 1.2rem 1rem 1.1rem 1rem;
  font-size: 1.1rem; line-height: 1.5;
  text-align: left; color: #fff;
  background: rgba(34,34,34,0.95);
  border-radius: 16px 16px 16px 16px; margin: 0;
}
.swipe-icons {
  display: flex;
  justify-content: space-between; /* â† å·¦å³å…©ç«¯ */
  align-items: center;
  width: 80%;     /* æˆ– 90%ï¼Œå¯èª¿æ•´ */
  padding:0.7rem 0 0 0; /* å·¦å³å…§ç¸®ä¸€é» */
  margin: 0 auto;
}
.card img {
  width: 100%; display: block;
  border-radius: 16px 16px 16px 16px;
  border-bottom: 1px solid #333;
  flex-shrink: 0;
}
.like-overlay {
  position: absolute; top: 50%; left: 50%;
  transform: translate(-50%,-50%) scale(.5);
  color: #ff6699; font-size: 2.5rem; font-weight: bold;
  pointer-events: none; opacity: 0;
  transition: opacity .2s, transform .2s;
}
.like-overlay.visible { opacity: 1; transform: translate(-50%,-50%) scale(3); }
.result-float { margin-top: 6vw; font-size: 1.1rem; opacity: 0; transition: opacity .6s; text-align: center; }
.result-float.visible { opacity: 1; }
    .swipe-hint-overlay {
  position: absolute;
  top:40%;
  left: 50%;
  transform: translateX(-50%);
 
  color: #e37b7b;
  padding: 0px 0px;
  border-radius: 6px;
  font-size: 1rem;
  z-index: 5;
  animation: hintWobble 2s infinite ease-in-out;
  pointer-events: none;
  user-select: none;
}
@keyframes hintWobble {
  0%   { transform: translateX(-50%) translateX(0); }
  25%  { transform: translateX(-50%) translateX(-8px); }
  50%  { transform: translateX(-50%) translateX(8px); }
  75%  { transform: translateX(-50%) translateX(-5px); }
  100% { transform: translateX(-50%) translateX(0); }
}


/* æ®µè½5ï¼šæˆ¿é–“æ•…äº‹ */
    #roomstory {
      display: none; 
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;     /* å¾ä¸Šæ–¹é–‹å§‹æ’åˆ— */
      padding-top: 12vh;               /* ç•™ç™½è®“æ®µè½å¾€ä¸‹ */
      background: #222 url('https://assets.onecompiler.app/43jm6npf3/43jzaj6qd/room-scene-03.png') center/cover no-repeat;
      padding: 3vw 2vw;
      box-sizing: border-box;
    }
        .roomstory-gradient {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 1;
  background: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 100%);
  opacity: 0.9; /* å¯èª¿æ•´ç‚º 0.7~1 çœ‹ä½ è¦å¤šæ·± */
  transition: opacity 1s;
}
    #roomstory-text {
      position: relative;
      font-size: 1.25rem;
      width: 100%;
      max-width: 660px;
      min-width: 260px;
      min-height: 20em;
      height: 12em;
      overflow: hidden;
      margin: 2rem auto;
      padding: 1rem 1.5rem;
       text-align: center;         /* âœ… æ•´é«”ç½®ä¸­ */
      box-sizing: border-box;
    }
    .roomstory-group {
      z-index: 2;
      position: absolute;
      left: 0; right: 0; top: 0;
      width: 100%;
      font-size: 2rem;
      color: #fff;
      line-height: 1.5;
      letter-spacing: 0.03em;
      white-space: pre-line;
      opacity: 0;
      transition: opacity 2S;
      pointer-events: none;
      padding: 0 1rem;
      box-sizing: border-box;
      text-align: center;
      /* æ–‡å­—å…‰æšˆæ•ˆæœåŠ å¼· */
      text-shadow:
        0 0 16px #ff3232,
        0 0 32px #fff,
        0 0 8px #ff5252,
        0 0 2px #fff;
      filter: brightness(1.07);
    }
    .roomstory-inner {
  margin-top: 20vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
}
    .roomstory-group.active {
      opacity: 1;
      pointer-events: auto;
    }
    #roomstory-controls {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .roomstory-btn {
      font-size: 1rem;
      padding: 0.6rem 1.8rem;
      border-radius: 8px;
      background: #ff5252;
      color: #fff;
      border: none;
      box-shadow: 0 2px 12px rgba(0,0,0,0.07);
      cursor: pointer;
      transition: background 0s, opacity 0.1s;
      user-select: none;
      margin-top: 3.5rem;  /* å¾€ä¸‹ç§»ï¼Œæ•¸å­—å¯èª¿æ•´ */
      z-index: 2;
    }
    .roomstory-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

  
    @media (max-width: 650px) {
      #roomstory-text {
        max-width: 150vw;
        min-width: 0;
        font-size: 0.5rem;
        height: auto;
        min-height: 20em;
      }
      .roomstory-group {
        font-size: 1rem;
      }
    }

/* æ®µè½6ï¼šBridge éå ´å‹•ç•« */
#bridge { 
  display: none;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  width: 600px;
  min-height: 300px;
  background: #FFF;
} }
.bridge-card {
  position: relative;
  width: 92vw; max-width: 340px;
  height: 300px;
  background: rgba(255,255,255,0.10);
  border-radius: 18px;
  box-shadow: 0 6px 24px rgba(0,0,0,0.20), 0 1.5px 6px rgba(0,0,0,0.06);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 1.2rem 1.2rem 2.4rem 1.2rem;
  backdrop-filter: blur(2px);
  margin: 0 auto;
}
.bridge-card img {
  width: 300PX;
  border-radius: 12px 12px 6px 6px;
  object-fit: cover;
  background: #333;
  margin-bottom: 1.3rem;
}
.bridge-text {
  font-size: 1.2rem;
  color: #fff;
  text-align: center;
  font-weight: bold;
  text-shadow: 0 2px 10px rgba(0,0,0,0.7);
  margin-bottom: 1rem;
  animation: wobble 2s infinite;
  letter-spacing: 0.5px;
}
.scroll-hint {
  font-size: 1rem;
  color: #ccc;
  animation: bounceDown 2s infinite;
  text-align: center;
  user-select: none;
  opacity: 0.8;
}

@keyframes bounceDown {
  0%   { transform: translateY(0); }
  50%  { transform: translateY(10px); }
  100% { transform: translateY(0); }
}

@keyframes wobble {
  0% { transform: translateX(0);}
  20% { transform: translateX(-7px);}
  40% { transform: translateX(7px);}
  60% { transform: translateX(-5px);}
  80% { transform: translateX(5px);}
  100% { transform: translateX(0);}
}
<!-- å½ˆå‡ºè¦–çª—ï¼šå’©æ¬¸ -->
<div id="sheep-modal" style="
  position:fixed; top:0; left:0; width:100vw; height:100vh;
  background:rgba(0,0,0,0.6); display:none;
  justify-content:center; align-items:center; z-index:999;
">
  <div style="
    background:#222; padding:2rem; border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.6); text-align:center;
    max-width:80%;
  ">
    <p style="
      margin-bottom:1.5rem; font-size:1.4rem;
      color:#f9f9f9; font-family:'Noto Serif TC', serif;
    ">å’©æ¬¸</p>
    <button id="sheep-reply-btn" style="
      background:#333; color:#f9f9f9; border:1px solid #555;
      padding:0.8rem 1.2rem; border-radius:8px;
      cursor:pointer; font-size:1rem;
      transition:background 0.3s,transform 0.2s;
    ">å’©æ¬¸</button>
  </div>
</div>

<style>
  .fade-item { opacity:0; transform:translateY(20px); transition:opacity .5s, transform .5s; }
  .fade-item.in { opacity:1; transform:translateY(0); }
  .fade-item.out { opacity:0; transform:translateY(-20px); }
</style>



<style>
#adventure {
  display:none;
  min-height:80vh;
  padding:4rem 1rem;
  background: #17202A;
  color: #fff;
  text-align:center;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  opacity:0; transition:opacity .8s;
  position:relative;
}
.fade-item { opacity:0; transform:translateY(20px); transition:opacity .5s, transform .5s; }
.fade-item.in { opacity:1; transform:translateY(0); }
.fade-item.out { opacity:0; transform:translateY(-20px); }

#adventure-choices {
  display: flex;
  flex-direction: column;    /* ç”±æ©«æ’æ”¹ç‚ºç›´æ’ */
  align-items: center;       /* å…§å®¹ç½®ä¸­ */
  gap: 1.2rem;               /* æŒ‰éˆ•é–“è· */
}

.adventure-choice-btn {
  width: 230px;              /* æˆ–100%ï¼Œçœ‹ä½ è¦å¤šå¯¬ */
  text-align: center;
  margin: 0;
  margin-bottom: 0.2em;
}
#adventure .adventure-choice-btn {
  background: #333; color:#f9f9f9; border:1px solid #555;
  padding:.8rem 1.2rem; border-radius:8px; cursor:pointer;
  margin:0.5rem;font-size:1rem;transition:background .3s,transform .2s;
}
#adventure .adventure-choice-btn:hover { background: #09876d; }
#back-btn, #continue-btn {
  display:none;
  margin:1rem auto 0;
  background:#333;
  color:#f9f9f9;
  border:1px solid #555;
  padding:0.8rem 1.2rem;
  border-radius:8px;
  cursor:pointer;
  font-size:1rem;
  transition:background .3s,transform .2s;
}


/* æ®µè½8ï¼šç¿»ç‰Œå½©è›‹ Highlights */
#highlights {
  display:none;
  padding:4rem 1rem;
  text-align:center;
  background:#0f0f0f;
  color:#f9f9f9;
  min-height:80vh;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}
.comic-grid {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2rem;
  margin: 0 auto;
  max-width: 90vw;
}
@media (min-width: 700px) {
  .comic-grid { flex-direction: row; }
}
.flip-card {
  position: relative;
  width: 300px;
  height: 300px;
  perspective: 1000px;
  cursor: pointer;
}
.flip-front,
.flip-back {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  backface-visibility: hidden;
  transform-origin: center bottom;
  transition: transform .6s cubic-bezier(.32,.72,.49,1.09);
  border-radius: 8px;
  display: flex; justify-content: center; align-items: center;
}
.flip-front { background: #222; transform: rotateX(0deg);}
.flip-back {
  background: #1a1a1a;
  color: #fff;
  flex-direction: column;
  text-align: center;
  padding: 1rem;
  transform: rotateX(-90deg);}
.flip-card.flipped .flip-front { transform: rotateX(90deg);}
.flip-card.flipped .flip-back { transform: rotateX(0deg);}
.subtitle {
  font-size: 1.08rem;
  color: #ffc7c7;
  margin-bottom: .6em;
  margin-top: .8em;
  font-weight: bold;
  letter-spacing: 1px;
}

/* æ®µè½9ï¼šèœ¥èœ´äººé©—è­‰ */
#alien-test {
  display:none;
  padding: 4rem 1rem;
  min-height:80vh;
  background: #191d23;
  color: #f9f9f9;
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.choice-btn, .reset-btn, .continue-btn {
  background: #222;
  color: #f9f9f9;
  border: none;
  padding: 1rem 1.5rem;
  border-radius: 6px;
  cursor: pointer;
  font-size: 1.125rem;
  min-width: 125px;
  transition: background 0.2s;
  margin: 1rem 0.5rem 0 0;
}
.choice-btn:hover, .reset-btn:hover, .continue-btn:hover { background: #444; }
#alien-result img {
  max-width: 300px;
  margin-top: 1rem;
  border-radius: 8px;
}
#alien-choices {
  display: flex;
  flex-direction: column;   /* ç”±æ©«æ’æ”¹ç‚ºç›´æ’ */
  align-items: center;      /* å­é …ç›®ç½®ä¸­ */
  gap: 1.2rem;              /* é¸é …é–“è·å¯è‡ªè¡Œèª¿æ•´ */
  max-width: 90vw;
  margin: 0 auto;
}

.choice-btn, .reset-btn, .continue-btn {
  width: 230px;            /* æˆ–100%æˆ–ä½ è¦çš„å¯¬åº¦ï¼Œç¢ºä¿è¦–è¦ºä¸Šå¤ å¤§ */
  text-align: center;
  margin: 0;               /* ä¸è¦æœ‰å³é‚Šè· */
  margin-bottom: 0.2em;
}

/* çµå°¾ç‰¹æ•ˆ */
#ending {
  display:none;
  position: relative;
  width: 100vw;
  height: 100vh;
  flex-direction:column;
  align-items: center;
  justify-content: center;
  text-align: center;
  background: #000;
}
#particle-canvas {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 3;
}
#background-gif {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 1;
}
#ending-text {
  position: relative;
  z-index: 2;
  font-size: 2rem;
  color: #fff;
  line-height: 1.4;
  text-shadow: 2px 2px 8px rgba(255,0,150,0.7),
               -2px -2px 8px rgba(0,255,150,0.7),
               2px -2px 8px rgba(150,150,255,0.7);
  animation: floatText 2s ease-in-out infinite alternate;
  margin-top: 8vh;
}
#restart-btn { z-index: 4; position: relative; }
@keyframes floatText {
  0% { transform: translateY(0); }
  100% { transform: translateY(-30px); }
}

  </style>
</head>
<!-- HTML -----------------HTML---------------------HTML---------------------------------->
<body>

<!-- æ®µè½1ï¼šæ—¥æœŸè¼¸å…¥ -->
<section class="cover-check" id="cover-check">
  <h2 style="text-align:center;">è«‹è¼¸å…¥é€™å€‹é‡è¦çš„æ—¥å­ ğŸ—“ï¸</h2>
  <div class="date-inputs">
    <input type="text" id="year" placeholder="å¹´">
    <input type="text" id="month" placeholder="æœˆ">
    <input type="text" id="day" placeholder="æ—¥">
    <button id="date-confirm-btn" onclick="checkDate()">ç²—èŠ±</button>
  </div>
</section>

<!-- æ®µè½2ï¼šæ‰“å­—å‹•ç•«é–‹å ´ -->
<section id="intro" style="display:none; justify-content:center; align-items:center; min-height:60vh; flex-direction:column;">
  <div>
    <h2 style="text-align:center;"></h2>
    <div class="typewriter" style="text-align:left; max-width:340px;">
      <p class="type-line" id="line1"></p>
      <p class="type-line" id="line2"></p>
      <p class="type-line" id="line3"></p>
      <p class="type-line" id="line4"></p>
      <p class="type-line" id="line5"></p>
      <span class="caret" id="caret">|</span>
    </div>
  </div>
  <button id="next-intro-btn" class="next-intro-btn" style="margin-top:2.5rem;">å‡ºç™¼å›‰</button>
</section>

<!-- æ®µè½3ï¼šAKAè‚–åƒæ®µ -->
<section id="portrait" style="display:none; flex-direction:column; align-items:center; justify-content:center; min-height:100vh;">
  <div class="portrait-card">
    <img src="https://assets.onecompiler.app/43jm6npf3/43jm3pwde/portrait-hero.png" alt="å°è²“å’ªæ¼«ç•«è‚–åƒ">
  </div>
  <div class="aka" id="aka1"> <br>åƒ…å‘ˆç¾çµ¦<br>æˆ‘æœ€æ„›çš„è€ç’˜å¯¶è²</div>
  <div class="aka" id="aka2">a.k.a. å°è²“å’ª</div>
  <div class="aka" id="aka3">a.k.a. éŸ³ç¬¦</div>
  <div class="aka" id="aka4">a.k.a. é»ƒè‰²å°é´¨é´¨</div>
  <div class="aka" id="aka5">a.k.a. åˆºå®¢å¤§å¸«</div>
  <div class="aka" id="aka6">a.k.a. æœªä¾†çš„é™³å¤ªå¤ª</div>
  <button id="next-portrait-btn" class="next-intro-btn" style="display:none; margin-top:2.5rem;">ç¹¼çºŒ</button>
</section>

<!-- æ®µè½4ï¼šTinderå¡ç‰‡æ®µ -->
<section id="tinder" style="display:none; padding: 4rem 1rem 3rem 1rem;">
  <h2 style="text-align: center; width: 100%;">é‚£å¤©ï¼Œæˆ‘åœ¨Tinderä¸Šç¬¬ä¸€çœ¼çœ‹åˆ°å¦³â€¦</h2>
  <div class="swipe-area">
    <div class="card" id="card">
      <div class="swipe-hint-overlay">å·¦æ»‘? or å³æ»‘?</div>
      <div class="profile-info">
        â€¢ æ²’è¾¦æ³•æ¥å—é®ªé­šåå¸<br>
        â€¢ è–¯é¤…è›‹é¤…ä¸€å®šåŠ ç•ªèŒ„é†¬<br>
        â€¢ 42 å…¬é‡Œ<br>
        â€¢ åœ‹ç«‹ä¸­æ­£å¤§å­¸
      </div>

      <div class="swipe-icons" style="display:flex; justify-content:space-between; align-items:center; width:100%; ">
        <span style="font-size:3rem; color:#f86a6a;">âŒ</span>
        <span style="font-size:3rem; color:#ff69b4;">â¤ï¸</span>
      </div>
      <img src="https://assets.onecompiler.app/43jm6npf3/43jm3pwde/livi-new.png" alt="Tinder ç…§ç‰‡">
      <div id="likeOverlay" class="like-overlay">ğŸ’•LIKE</div>
    </div>

    <div class="result-float" id="swipe-result"></div>
    <button id="next-tinder-btn" class="next-intro-btn" style="display:none; margin-top:2.5rem;">ç¹¼çºŒ</button>
  </div>
</section>

<!-- æ®µè½5ï¼šæˆ¿é–“æ•…äº‹æ®µè½ -->
 <section id="roomstory"style="display:none;">
     <div class="roomstory-gradient"></div>
     <div class="roomstory-inner">
     <div id="roomstory-text">
      æœ‰é‚£éº¼å¹¾å¤©æ¸…æ™¨çš„ç¬¬ä¸€ç¸·å…‰ç·š<br>
      å¾çª—é‚Šå¾®å¾®å‚¾è½ï¼Œ<br>
      æˆ‘å»è‘—ä½ çš„é¡é ­ï¼Œ<br>
      æ­¤æ™‚çš„ä½ <br>
      ä¹Ÿè¨±é‚„ç†Ÿç¡ä¹Ÿè¨±åœ¨åŠå¤¢ä¹‹é–“ï¼›<br>
      ä¹Ÿæœ‰é‚£éº¼å¹¾å¤©...<br>
      æˆ‘å€‘åœ¨é€™å€‹è§’è½<br>
      ç¬¬ä¸€æ¬¡èŠäººç”Ÿã€èŠå¤¢æƒ³ã€‚<br>
      æˆ‘æ»¿è¶³äº†å¦³å¾ˆå¤šæƒ³åƒï¼Œ<br>
      ä½ ç¸½èªªæˆ‘å¾ˆå¸¥ä¹Ÿèªªæˆ‘å¾ˆå¯æ„›ï¼Œ<br>
      æ²’æœ‰äººåƒä½ é€™æ¨£çœŸèª ã€‚<br>
      æˆ‘å€‘èªè­˜1å€‹æœˆã€è¦‹é¢2æ¬¡ã€æ›–æ˜§3å°æ™‚ï¼Œ<br>
      ç„¶å¾Œé‚£æ™šæˆ‘å€‘åœ¨ä¸€èµ·äº†ï¼<br>
      åœ¨æ­¤ä¹‹å‰æˆ‘å¾ˆé›£æƒ³åƒï¼Œ<br>
      é€™å€‹äººæœƒé¡˜æ„ç”¨ä¸€è¼©å­é™ªæˆ‘ï¼Œ<br>
      ä½ è®“æˆ‘å…¨å®‡å®™æœ€å¹¸ç¦çš„äººï¼Œ<br>
      è€Œä½ ï¼Œè€ç’˜ä½ çŸ¥é“å—ï¼Ÿ<br>
      ä½ ä¹Ÿå€¼å¾—å’Œæˆ‘ä¸€æ¨£å¹¸ç¦ã€‚<br>
      å°±é€™æ¨£å…©å¹´äº†ï¼Œ<br>
      æˆ‘å€‘ç”¨ç„¡æ•¸æ¸…æ™¨å’Œæ·±å¤œï¼Œ<br>
      æŠŠé€™å¼µåºŠã€é€™å€‹è§’è½ï¼Œ<br>
      å¡«æ»¿äº†åªå±¬æ–¼æˆ‘å€‘çš„å›æ†¶ï¼Œ<br>
      ä¸¦å¸¶åˆ°ç¾åœ¨çš„åœ°æ–¹ï¼Œ<br>
      ä¹Ÿå¸¶å»æœªä¾†æ‰€æœ‰èµ°çš„åœ°æ–¹ã€‚
    </div>
    <div id="roomstory-controls">
      <button id="prev-group" class="roomstory-btn">â­ </button>
      <button id="next-group" class="roomstory-btn">â­¢</button>
      </div>
      <button id="roomstory-next" class="roomstory-btn" style="display:none;" onclick="goToBridge()">å¯å±‹</button>
</section>

<!-- æ®µè½6ï¼šéå ´å‹•ç•«ï¼ˆBridgeï¼‰-->
<section id="bridge" style="display:none; justify-content:center; align-items:center; width:100vw; min-height:60vh; background:#000;">
  <div class="bridge-card">
    <img src="https://media.giphy.com/media/nNxT5qXR02FOM/giphy.gif" alt="éå ´">
    <div class="bridge-text">è‚‰éº»çš„éƒ¨åˆ†çµæŸï¼Œå¥½ç©çš„æ­£è¦é–‹å§‹ï½</div>
        <button id="next-bridge-btn" class="next-intro-btn" style="margin-top: 2rem;">å•µå•µ</button>
    <div class="scroll-hint">â¬‡ å•µå•µå®Œå¾€ä¸‹æ»‘çœ‹çœ‹ â¬‡</div>
  </div>
</section>


<!-- æ®µè½7ï¼šå°å†’éšªäº’å‹•é¸æ“‡æ®µ -->
<section id="adventure">
  <h2 class="fade-item" style="margin-bottom:2rem;">é‚„è¨˜å¾—å—...</h2>
  <div id="adventure-text" class="fade-item" style="font-size:1.2rem; margin-bottom:1.5rem;"></div>
  <div id="adventure-choices" class="fade-item"></div>
  <button id="back-btn" class="fade-item">ä¸Šä¸€æ­¥</button>
  <button id="continue-btn" class="fade-item">ç¹¼çºŒ</button>
</section>
<!-- å½ˆå‡ºè¦–çª—ï¼šå’©æ¬¸ -->
<div id="sheep-modal" style="
  position:fixed; top:0; left:0; width:100vw; height:100vh;
  background:rgba(0,0,0,0.6); display:none;
  justify-content:center; align-items:center; z-index:999;
">
  <div id="sheep-modal-content" style="
    background:#222; 
    padding:2.5rem 2rem;      /* å…§è·å¯åŠ å¤§ */
    border-radius:18px;       /* åœ“è§’åŠ å¤§ */
    box-shadow:0 4px 20px rgba(0,0,0,0.7);
    text-align:center;
    width: min(350px,90vw);   /* å›ºå®šæœ€å¤§å¯¬åº¦ï¼Œä¹Ÿå¯ç”¨max-width */
    min-width:200px;
    min-height:180px;
    max-width:95vw;           /* ä¸æœƒè¶…å‡ºæ‰‹æ©Ÿç•«é¢ */
    margin: 0 auto;
  ">
    <p style="
      margin-bottom:1.5rem; font-size:1.4rem;
      color:#f9f9f9; font-family:'Noto Serif TC', serif;
    ">å’©æ¬¸</p>
    <button id="sheep-reply-btn" style="
      background:#333; color:#f9f9f9; border:1px solid #555;
      padding:0.8rem 1.2rem; border-radius:8px;
      cursor:pointer; font-size:1rem;
      transition:background 0.3s,transform 0.2s;
    ">å’©æ¬¸</button>
  </div>
</div>
</section>

<!-- æ®µè½8ï¼šç¿»ç‰Œå½©è›‹ Highlights -->
<section id="highlights" style="display:none; flex-direction:column; align-items:center; justify-content:center;">
  <h2 style="font-family:'Noto Serif TC', serif; font-size:1.8rem; margin-bottom:2rem;">ğŸ‰ HIGHLIGHT TIME ğŸ‰</h2>
  <div class="comic-grid">
      <div class="flip-card">
        <div class="flip-front">
          <img src="https://assets.onecompiler.app/43jm6npf3/43jm3pwde/hl1.png" alt="å¤§å±é©šå–œ" style="width:100%; height:100%; object-fit:cover;">
        </div>
        <div class="flip-back">
          <h3>å·æ”¾äº†å€‹å¤§å±<br>è¢«æˆ‘ç™¼ç¾</h3>
          <p class="subtitle">æˆ‘æƒ³è®“ä½ çŸ¥é“â€¦</p>
          <p>ã€Œæœ‰ä½ åœ¨ï¼Œç”Ÿæ´»å¤§å°äº‹<br>ä¹Ÿå¯ä»¥å¾ˆæœ‰è¶£ã€</p>
        </div>
      </div>
      <div class="flip-card">
        <div class="flip-front">
          <img src="https://assets.onecompiler.app/43jm6npf3/43jm3pwde/hl2.png" alt="é™ªä¼´é™è‡¨" style="width:100%; height:100%; object-fit:cover;">
        </div>
        <div class="flip-back">
          <h3>2023.09.10<br>åœ¨ä½ ä½è½æ™‚<br>è·‘å»å˜‰ç¾©é™ªä½ </h3>
          <p class="subtitle">æˆ‘æƒ³è®“ä½ çŸ¥é“â€¦</p>
          <p>ã€Œæˆ‘é¡˜æ„æ¥ä½ä½ ã€</p>
        </div>
      </div>
      <div class="flip-card">
        <div class="flip-front">
          <img src="https://assets.onecompiler.app/43jm6npf3/43jm3pwde/hl3.png" alt="ä¸€èµ·çœ‹è¡¨æ¼”" style="width:100%; height:100%; object-fit:cover;">
        </div>
        <div class="flip-back">
          <h3>2024.03.11<br>ä½ è·Ÿæˆ‘å»çœ‹è¡¨æ¼”</h3>
          <p class="subtitle">æˆ‘æƒ³è®“ä½ çŸ¥é“â€¦</p>
          <p>ã€Œæ„Ÿè¬é™ªè‘—å½¼æ­¤<br>åšæœ€å–œæ­¡çš„äº‹æƒ…ã€</p>
        </div>
      </div>
      <div class="flip-card">
        <div class="flip-front">
          <img src="https://assets.onecompiler.app/43jm6npf3/43jm3pwde/hl4.png" alt="ç¾å¥½å¸åº·" style="width:100%; height:100%; object-fit:cover;">
        </div>
        <div class="flip-back">
          <h3>2023.05.13<br>ç¬¬ä¸€æ¬¡ç´„æœƒ<br>å»å’–å•¡åº—åƒ<br>ä½ æœ€æ„›çš„å¸åº·</h3>
          <p class="subtitle">æˆ‘æƒ³è®“ä½ çŸ¥é“â€¦</p>
          <p>ã€Œå’Œä½ å…±åº¦çš„æ¯ä¸€åˆ»<br>éƒ½å¾ˆç¾å¥½ã€</p>
        </div>
      </div>
    </div>
  <button id="highlights-next-btn" class="next-intro-btn" style="display:inline-block; margin:3rem auto 0 auto;">ç¹¼çºŒ</button>
</section>

<!-- æ®µè½9ï¼šèœ¥èœ´äººé©—è­‰æ®µ -->
<section id="alien-test"style="display:none;">
  <h2>ğŸ¦ å¤–æ˜Ÿèœ¥èœ´äººèº«åˆ†æ¸¬è©¦</h2>
  <p>å¦‚æœæˆ‘å€‘å…¶ä¸­ä¸€äºº<br>è¢«å¤–æ˜Ÿèœ¥èœ´äººç¶æ¶ä¸¦æ›¿æ›æˆå…‹éš†äººï¼Œ<br>è¦ç”¨ä»€éº¼æš—è™Ÿç¢ºèªå½¼æ­¤èº«åˆ†ï¼Ÿ</p>
  <div id="alien-choices">
    <button class="choice-btn" data-answer="A">A. å™—å’•</button>
    <button class="choice-btn" data-answer="B">B. å‘±å‘±</button>
    <button class="choice-btn" data-answer="C">C. å’©æ¬¸</button>
    <button class="choice-btn" data-answer="D">D. å•µå•µ</button>
  </div>
  <div id="alien-result"></div>
</section>

<!-- æ®µè½10ï¼šé£›å¤©å°å¥³è­¦çµå°¾ç‰¹æ•ˆ -->
<section id="ending">
  <canvas id="particle-canvas"></canvas>
  <img id="background-gif" src="https://media.giphy.com/media/2fWhltsC9ImfoNEJ0F/giphy.gif" alt="é£›å¤©å°å¥³è­¦">
  <div id="ending-text">
    æ¯”å“ºç”Ÿæ—¥å¿«æ¨‚ï¼<br>è¦å¤©å¤©é–‹å¿ƒå–”ï¼<br>æ„›ä½ ã„‰ç‹—å‹¾ç‚ºæ‚¨å‘ˆç»
  </div>
  <button id="restart-btn" class="next-intro-btn" style="margin-top: 2rem;">é‡æ–°é–‹å§‹æ—…ç¨‹</button>

</section>

<!-- JS æ•´åˆ -------------------------------------------------------------------------------------------------->
<script>
  // æ®µè½å‚³é€é–€
  function jumpToSection(id) {
  const ids = [
    'cover-check','intro','portrait','tinder','roomstory','bridge',
    'adventure','highlights','alien-test','ending'
  ];
  ids.forEach(sec => {
    const el = document.getElementById(sec);
    if (el) el.style.display = 'none';
  });
  const target = document.getElementById(id);
  if (target) {
    const useFlex = ['intro','portrait','tinder','roomstory','bridge','adventure','highlights','alien-test','ending'];
    target.style.display = useFlex.includes(id) ? 'flex' : 'block';

    // è‹¥éœ€è¦åˆå§‹åŒ–æ®µè½å…§å®¹ï¼ˆå¦‚æˆ¿é–“æ•…äº‹ã€ç‰¹æ•ˆç­‰ï¼‰å¯åŠ ï¼š
    if (id === 'roomstory') setupRoomStoryManualSwitching?.();
    if (id === 'ending') setTimeout(startParticles, 200);
  }
}
  
  // Ripple æŒ‰éˆ•æ•ˆæœ
  window.onload = () => {
    document.querySelectorAll(".next-intro-btn").forEach(button => {
      button.addEventListener("click", (event) => {
        const target = event.currentTarget;
        const circle = document.createElement("span");
        const diameter = Math.max(target.clientWidth, target.clientHeight);
        const radius = diameter / 2;
        circle.style.width = circle.style.height = `${diameter}px`;
        circle.style.left = `${event.offsetX - radius}px`;
        circle.style.top = `${event.offsetY - radius}px`;
        circle.classList.add("ripple");
        const ripple = target.querySelector(".ripple");
        if (ripple) ripple.remove();
        target.appendChild(circle);
      });
    });
  };


  document.addEventListener("DOMContentLoaded", function() {
      var restartBtn = document.getElementById("restart-btn");
  if (restartBtn) {
    restartBtn.onclick = resetToCover;
  } else {
    console.log("restart-btn not found when binding!");
  }
    // æ®µ1ï¼šæ—¥æœŸæª¢æŸ¥
    document.getElementById('date-confirm-btn').onclick = function() {
      const y = document.getElementById("year").value.trim();
      const m = document.getElementById("month").value.trim();
      const d = document.getElementById("day").value.trim();
      if (y === "1997" && m === "5" && d === "22") {
        alert("æˆ‘çš„å°ˆå±¬å¤©ä½¿ï¼Œæº–å‚™å¥½äº†å—?");
        document.getElementById("cover-check").style.display = "none";
        document.getElementById("intro").style.display = "flex";
        setTimeout(() => revealLine(0), 500);
      } else alert("å†æƒ³æƒ³çœ‹ï¼");
    };
    // æ®µ2ï¼šæ‰“å­—å‹•ç•«
    const lines = [
      "æˆ‘æ„›ä½ ï¼Œ",
      "ä¸æ˜¯å› ç‚ºä½ æ˜¯èª°ï¼Œ ",
      "è€Œæ˜¯å› ç‚ºåœ¨ä½ é¢å‰ï¼Œ ",
      "æˆ‘å¯ä»¥æ˜¯èª°ã€‚ ",
      "â€” Roy Croft "
    ];
    function revealLine(i) {
      const p = document.getElementById("line" + (i + 1));
      const caret = document.getElementById("caret");
      if (!p) return;
      let idx = 0;
      p.textContent = "";
      caret.style.display = "inline-block";
      const iv = setInterval(() => {
        p.textContent += lines[i][idx++];
        if (idx === lines[i].length) {
          clearInterval(iv);
          caret.style.display = "none";
          if (i < lines.length - 1) {
            setTimeout(() => revealLine(i + 1), 700);
          } else {
            caret.style.display = "inline-block";
            document.getElementById("next-intro-btn").style.display = "block";
          }
        }
      }, 80);
    }
    // æ®µ3ï¼šé€²å…¥ AKA
    document.getElementById("next-intro-btn").onclick = function () {
      document.getElementById("intro").style.display = "none";
      document.getElementById("portrait").style.display = "block";
      const akas = document.querySelectorAll(".aka");
      akas.forEach((el, i) => {
        setTimeout(() => {
          el.classList.add("visible");
          if (i === akas.length - 1) {
            document.getElementById("next-portrait-btn").style.display = "block";
          }
        }, 600 + i * 400);
      });
    };
    // æ®µ4ï¼šTinder
    document.getElementById("next-portrait-btn").onclick = function () {
      document.getElementById("portrait").style.display = "none";
      document.getElementById("tinder").style.display = "block";
    };
    (function(){
      const card = document.getElementById('card');
      const likeOverlay = document.getElementById('likeOverlay');
      const result = document.getElementById('swipe-result');
      const nextBtn = document.getElementById('next-tinder-btn');
      let startX = null, offsetX = 0, done = false;
      card.addEventListener('pointerdown', e => {
        if(done) return;
        startX = e.clientX;
        card.setPointerCapture(e.pointerId);
      });
      card.addEventListener('pointermove', e => {
        if (startX !== null && !done) {
          offsetX = e.clientX - startX;
          card.style.transform = `translateX(${offsetX}px) rotate(${offsetX/10}deg)`;
          likeOverlay.classList.toggle('visible', offsetX > 60);
        }
      });
      card.addEventListener('pointerup', e => {
        if(done) return;
        card.releasePointerCapture(e.pointerId);
        likeOverlay.classList.remove('visible');
        if (offsetX > 100) showResult(true);
        else if (offsetX < -100) showResult(false);
        else card.style.transform = '';
        startX = null;
      });
      function showResult(match) {
        done = true;
        card.style.opacity = 0;
        const hintOverlay = document.querySelector('.swipe-hint-overlay');
        if (hintOverlay) hintOverlay.style.display = 'none';

        if (match) {
          result.innerHTML =
              `âœ… Match æˆåŠŸï¼<br>æˆ‘æƒ³æˆ‘åšäº†äººç”Ÿæœ€é‡å¤§çš„é¸æ“‡â€¦<br>
       <img src="https://assets.onecompiler.app/43jm6npf3/43jm3pwde/bubu1.png" alt="Match æˆåŠŸ" style="max-width:300px;">
       <br>
       <button id="retry-tinder-btn" class="next-intro-btn" style="margin-top:1.5rem;display:inline-block;">è©²ä¸æœƒé‚„æƒ³å†æ»‘ä¸€æ¬¡?</button>
      `;
    nextBtn.style.display = "block";
    setTimeout(()=>{
      const retryBtn = document.getElementById('retry-tinder-btn');
      if(retryBtn){
        retryBtn.onclick = function() {
          result.classList.remove('visible');
          result.innerHTML = '';
          card.style.opacity = 1;
          card.style.transform = '';
          done = false;
          if (hintOverlay) hintOverlay.style.display = 'block';
          nextBtn.style.display = "none";
        }
      }
    },100);
        } else {
          result.innerHTML =
            `âŒ å“å‘€...<br>å¦³å°±é€™æ¨£éŒ¯éäº†å½¼æ­¤â€¦<br>
             <img src="https://media.giphy.com/media/y6lu312reRzVC46yFn/giphy.gif" alt="éŒ¯é" style="max-width:300px;">
             <br><button id="retry-tinder-btn" class="next-intro-btn" style="margin-top:1.5rem;display:inline-block;">å†æ»‘ä¸€æ¬¡</button>`;
          setTimeout(()=>{
            const retryBtn = document.getElementById('retry-tinder-btn');
            if(retryBtn){
              retryBtn.onclick = function() {
                result.classList.remove('visible');
                result.innerHTML = '';
                card.style.opacity = 1;
                card.style.transform = '';
                done = false;
              }
            }
          },100);
        }
        result.classList.add('visible');
      }
      nextBtn.onclick = function() {
        document.getElementById("tinder").style.display = "none";
        document.getElementById("roomstory").style.display = "block";
      }
    })();
    
    
    // æ®µ5ï¼šæˆ¿é–“æ•…äº‹
function splitTextIntoGroups(text, groupSize = 3) {
  const sentences = text.replace(/<br\s*\/?>/gi, '\n')
    .split('\n')
    .map(s => s.trim())
    .filter(Boolean);
  let groups = [];
  for (let i = 0; i < sentences.length; i += groupSize) {
    groups.push(sentences.slice(i, i + groupSize).join('\n'));
  }
  return groups;
}
function setupRoomStoryManualSwitching() {
  const textEl = document.getElementById('roomstory-text');
  const originalHTML = textEl.innerHTML;
  const groups = splitTextIntoGroups(originalHTML, 3);

  textEl.innerHTML = groups.map((g, i) =>
    `<div class="roomstory-group${i === 0 ? ' active' : ''}" style="opacity:${i===0?1:0}">${g}</div>`
  ).join('');

  const groupEls = textEl.querySelectorAll('.roomstory-group');
  let current = 0;
  const transitionTime = 200;
  const prevBtn = document.getElementById('prev-group');
  const nextBtn = document.getElementById('next-group');
  const finalBtn = document.getElementById('roomstory-next');

  function updateBtn() {
    prevBtn.disabled = current === 0;
    nextBtn.disabled = current === groupEls.length - 1;
    finalBtn.style.display = (current === groupEls.length - 1) ? "block" : "none";
  }
  function showGroup(idx) {
    if (idx === current) return;
    groupEls[current].classList.remove('active');
    groupEls[current].style.opacity = 0;
    setTimeout(() => {
      groupEls[idx].classList.add('active');
      groupEls[idx].style.opacity = 1;
      current = idx;
      updateBtn();
    }, transitionTime);
  }
  prevBtn.addEventListener('click', function () {
    if (current > 0) showGroup(current - 1);
  });
  nextBtn.addEventListener('click', function () {
    if (current < groupEls.length - 1) showGroup(current + 1);
  });
  updateBtn();
}
setupRoomStoryManualSwitching();
document.getElementById("roomstory-next").addEventListener("click", function () {
  
  // éš±è—æˆ¿é–“æ®µè½
  document.getElementById("roomstory").style.display = "none";
  
  
  // é¡¯ç¤º bridge æ®µè½
  const bridge = document.getElementById("bridge");
  bridge.style.display = "flex";
});
function goToBridge() {
  document.getElementById("roomstory").style.display = "none";
  document.getElementById("bridge").style.display = "flex";
}

    // æ®µ6ï¼šBridge â†’ å°å†’éšª
   document.getElementById("next-bridge-btn").onclick = () => {
  alert("It's å•µå•µ time~");
  document.getElementById("bridge").style.display = "flex";
  const adv = document.getElementById("adventure");
  adv.style.display = "flex";
  setTimeout(()=>adv.style.opacity=1,10);
};
    // æ®µ7ï¼šå°å†’éšªäº’å‹•
(function(){
  const flow = {
    start: { t:"æˆ‘å€‘ç¬¬ä¸€æ¬¡è¦‹é¢çš„åœ°æ–¹ï¼Ÿ", c:[
      {t:"å…¬åœ’è·¯ PARKrd",n:"wrong"},{t:"åŒ—é–€è·¯ BEIMENrd",n:"room"}
    ]},
    wrong:{ t:"å“ˆå“ˆçŒœéŒ¯ï½å…¶å¯¦æ˜¯åŒ—é–€è·¯ï¼", c:[{t:"ç¹¼çºŒ",n:"room"}]},
    room:{ t:"ä½ æ˜¯å¦é‚„è¨˜å¾—æˆ‘å€‘åœ¨ä¸€èµ·çš„é‚£å€‹ä¸‹åˆæˆ‘å€‘åœ¨æˆ¿é–“åšä»€éº¼ï¼Ÿ", c:[
      {t:"ä½ çœ‹è‘—æˆ‘çš„æ‹çš„åº•ç‰‡",n:"room1"},{t:"ä½ è·Ÿæˆ‘åœ¨é–’èŠè«–æ–‡",n:"room2"}
    ]},
    room1:{ t:"æˆ‘å¸Œæœ›æˆ‘å€‘çš„æœªä¾†ä¹Ÿèƒ½è¢«è¨˜éŒ„è‘—", c:[
      {t:"ä¸‹ä¸€é¡Œ",n:"drink"},{t:"ä¸Šä¸€é¡Œ",n:"room"}
    ]},
    room2:{ t:"ä¹Ÿè¨±æˆ‘å€‘çš„å¹¸ç¦ç†è«–å¯ä»¥ä¸€èµ·è«–è¿°", c:[
      {t:"ä¸‹ä¸€é¡Œ",n:"drink"},{t:"å†é¸ä¸€æ¬¡",n:"room"}
    ]},
    drink:{ t:"é‚£æ™šæ´¾å°æˆ‘å€‘å–äº†ï¼Ÿ", c:[
      {t:"å¯æ¨‚å¨œ Corona",n:"end1"},{t:"æœæ—¥ Asahi",n:"end2"}
    ]},
    end1:{ t:"ç”Ÿæ—¥å¿«æ¨‚ï¼ä½ æ˜¯å¦é‚„è¨˜å¾—æ¸…çˆ½çš„å¯æ¨‚å¨œé…æª¸æª¬çš„é‚£å€‹é…¸ç”œå¥½æ¯”æˆ‘å€‘ç´„æœƒé‚£å¤©çš„æ„Ÿè¦º", c:[
      {t:"å†ç©ä¸€æ¬¡",n:"start"},{t:"ä¸Šä¸€é¡Œ",n:"drink"},{t:"ç¹¼çºŒ",n:"next"}
    ]},
    end2:{ t:"ç”Ÿæ—¥å¿«æ¨‚ï¼ä¹Ÿè¨±æ˜¯é‚£æ™šçš„æœ€å¾Œä¸€æ¯é…’ï¼Œæ°£æ³¡èˆ‡é…’ç²¾çš„æ˜‡è¯ä½¿æˆ‘é¼“èµ·å‹‡æ°£å¸¶ä½ èµ°å‘å¹¸ç¦", c:[
      {t:"å†ç©ä¸€æ¬¡",n:"start"},{t:"ä¸Šä¸€é¡Œ",n:"drink"},{t:"ç¹¼çºŒ",n:"next"}
    ]}
  };

  const txt = document.getElementById('adventure-text');
  const ch  = document.getElementById('adventure-choices');
  const sec = document.getElementById('adventure');
  const backBtn = document.getElementById('back-btn');
  const contBtn = document.getElementById('continue-btn');
  const modal = document.getElementById('sheep-modal');
  const replyBtn = document.getElementById('sheep-reply-btn');

  function clearFade(){ sec.querySelectorAll('.fade-item').forEach(el=>el.classList.remove('in','out')); }
  function fadeOut(callback){ sec.querySelectorAll('.fade-item').forEach(el=>el.classList.add('out')); setTimeout(callback,500); }
  function fadeIn(){ sec.querySelectorAll('.fade-item').forEach((el,i)=>setTimeout(()=>el.classList.add('in'),i*100)); }

  function render(key){
    sec.style.opacity = 1;
    const node = flow[key]; if(!node) return;
    fadeOut(()=>{
      txt.textContent = node.t;
      ch.innerHTML = '';
      backBtn.style.display = 'none'; contBtn.style.display = 'none';
      node.c.forEach(opt=>{
        if(opt.n==='next'){
          contBtn.style.display='block'; contBtn.onclick=()=>{ modal.style.display='flex'; };
        } else {
          const btn=document.createElement('button'); btn.textContent=opt.t;
          btn.className = "adventure-choice-btn";
          btn.onclick=()=>render(opt.n);
          ch.appendChild(btn);
        }
      });
      if(key==='room'){ backBtn.style.display='block'; backBtn.onclick=()=>render('start'); }
      else if(key==='drink'){ backBtn.style.display='block'; backBtn.onclick=()=>render('room'); }
      clearFade(); fadeIn();
    });
  }
  window.render = render;
  render('start');

  // åƒ…ä¿ç•™ä¸€æ¬¡ replyBtn.onclick
  replyBtn.onclick = ()=>{
    modal.style.display='none';
    showHighlights();
  };
})();

// æ®µè½8ï¼šç¿»ç‰Œåˆå§‹åŒ–èˆ‡é€²å…¥
function initHighlightFlip() {
  document.querySelectorAll('.flip-card').forEach(card => {
    card.addEventListener('click', () => {
      document.querySelectorAll('.flip-card').forEach(c => c.classList.remove('flipped'));
      card.classList.add('flipped');
    });
  });
}
function showHighlights() {
  document.getElementById('adventure').style.display = 'none';
  const highlights = document.getElementById('highlights');
  highlights.style.display = 'flex';
  initHighlightFlip();
}

// æ®µ8â†’9ï¼šç¿»ç‰Œâ†’èœ¥èœ´äºº
document.getElementById("highlights-next-btn").onclick = function(){
  document.getElementById('highlights').style.display = 'none';
  document.getElementById('alien-test').style.display = 'flex';
};

// æ®µ9ï¼šèœ¥èœ´äººé©—è­‰
(function(){
  const choices = document.getElementById("alien-choices"),
        result  = document.getElementById("alien-result"),
        correct = "C";
  function resetChoices() {
    choices.style.display = "flex";
    result.innerHTML = "";
  }
  function showEnding() {
    document.getElementById("alien-test").style.display = "none";
    document.getElementById("ending").style.display = "flex";
    setTimeout(startParticles, 200);
  }
  choices.onclick = e => {
    if (!e.target.matches("button")) return;
    const ans = e.target.getAttribute("data-answer");
    choices.style.display = "none";
    if (ans === correct) {
      result.innerHTML = `
        <p>âœ… ç­”å°!ä½ æ˜¯è°æ˜è²“è²“ï½ä¸æ˜¯èœ¥èœ´äºº</p>
        <img src="https://media.giphy.com/media/XFvd6z0HqnwZhFb5en/giphy.gif">
        <br>
        <button class="reset-btn">è©¦è©¦å…¶ä»–é¸æ“‡</button>
        <button class="continue-btn">ç¹¼çºŒ</button>
      `;
    } else {
      let msg = "", btn = "", gif = "https://media.giphy.com/media/y6lu312reRzVC46yFn/giphy.gif";
      if (ans === "A") {
        msg = "âŒ è‡­è‡­!!å†çŒœä¸€æ¬¡~";
        btn = `<button class="reset-btn">è‡­è‡­ï¼Œå†çŒœä¸€æ¬¡~</button>`;
      } else if (ans === "B") {
        msg = "âŒ å‘±å‘±!!é½é½ä½ æƒ³ç‘Ÿç‘Ÿå–”ï¼Œå†çŒœä¸€æ¬¡ï¼Ÿ";
        btn = `<button class="reset-btn">é½é½ä½ æƒ³ç‘Ÿç‘Ÿå–”ï¼Œå†çŒœä¸€æ¬¡?</button>`;
      } else if (ans === "D") {
        msg = "âŒ å•µå•µå½—æ˜Ÿä¼ºå€™!!!è·Ÿæˆ‘å•µå•µ10ç§’å®Œå†çŒœä¸€æ¬¡ <3";
        btn = `<button class="reset-btn">ç½°ä½ è·Ÿæˆ‘å•µå•µå®Œå†çŒœä¸€æ¬¡ <3</button>`;
      }
      result.innerHTML = `<p>${msg}</p><img src="${gif}"><br>${btn}`;
    }
    result.querySelectorAll
    (".reset-btn").forEach(b => b.onclick = resetChoices);
    result.querySelectorAll
    result.querySelectorAll(".continue-btn").forEach(b => b.onclick = function() {
      alert("æ­å–œå®ŒæˆæŒ‘æˆ°ï¼Œè«‹ç´¢å–å•µå•µçå‹µï¼");
      showEnding();
    });
  };
})();

    // æ®µ7â†’8ï¼šå°å†’éšªã€Œå’©æ¬¸ã€â†’ç¿»ç‰Œ
advNextBtn.onclick = function() {
  document.getElementById("adventure").style.display = "none";
  document.getElementById("highlights").style.display = "flex";
  setupRoomStoryManualSwitching(); // â¬… åŠ é€™è¡Œæ‰æœƒå•Ÿå‹•æ®µè½åˆ‡æ›é‚è¼¯
};
    // æ®µ8ï¼šç¿»ç‰Œå½©è›‹äº’å‹•
 function initHighlightFlip() {
  document.querySelectorAll('.flip-card').forEach(card => {
    card.addEventListener('click', () => {
      document.querySelectorAll('.flip-card').forEach(c => c.classList.remove('flipped'));
      card.classList.add('flipped');
    });
  });
}

// åœ¨é€²å…¥ highlights æ®µè½æ™‚å‘¼å«
function initHighlightFlip() {
  document.querySelectorAll('.flip-card').forEach(card => {
    card.addEventListener('click', () => {
      document.querySelectorAll('.flip-card').forEach(c => c.classList.remove('flipped'));
      card.classList.add('flipped');
    });
  });
}

function initHighlightFlip() {
  document.querySelectorAll('.flip-card').forEach(card => {
    card.addEventListener('click', () => {
      document.querySelectorAll('.flip-card').forEach(c => c.classList.remove('flipped'));
      card.classList.add('flipped');
    });
  });
}

function showHighlights() {
  document.getElementById('adventure').style.display = 'none';
  const highlights = document.getElementById('highlights');
  highlights.style.display = 'flex';
  initHighlightFlip();
}
// ç„¶å¾Œåœ¨å†’éšªæµç¨‹çš„ modal replyBtn è£¡é€™æ¨£å¯«ï¼š
replyBtn.onclick = ()=>{
  modal.style.display='none';
  showHighlights();
};
// æ®µ8â†’9ï¼šç¿»ç‰Œâ†’èœ¥èœ´äºº
document.getElementById("highlights-next-btn").onclick = function(){
  document.getElementById('highlights').style.display = 'none';
  document.getElementById('alien-test').style.display = 'flex';
};
    // æ®µ9ï¼šèœ¥èœ´äººé©—è­‰
    (() => {
      const choices = document.getElementById("alien-choices"),
            result  = document.getElementById("alien-result"),
            correct = "C";
      function resetChoices() {
        choices.style.display = "flex";
        result.innerHTML = "";
      }
      function showEnding() {
        document.getElementById("alien-test").style.display = "none";
        document.getElementById("ending").style.display = "flex";
        setTimeout(startParticles, 200);
      }
      choices.onclick = e => {
        if (!e.target.matches("button")) return;
        const ans = e.target.getAttribute("data-answer");
        choices.style.display = "none";
        if (ans === correct) {
          result.innerHTML = `
            <p>âœ… ç­”å°ï¼è°æ˜è²“è²“~</p>
            <img src="https://media.giphy.com/media/XFvd6z0HqnwZhFb5en/giphy.gif">
            <br>
            <button class="reset-btn">è©¦è©¦å…¶ä»–é¸æ“‡</button>
            <button class="continue-btn">ç¹¼çºŒ</button>
          `;
        } else {
          let msg = "", btn = "", gif = "https://media.giphy.com/media/y6lu312reRzVC46yFn/giphy.gif";
          if (ans === "A") {
            msg = "âŒ è‡­è‡­!!å†çŒœä¸€æ¬¡~";
            btn = `<button class="reset-btn">è‡­è‡­ï¼Œå†çŒœä¸€æ¬¡~</button>`;
          } else if (ans === "B") {
            msg = "âŒ å‘±å‘±!!é½é½ä½ æƒ³ç‘Ÿç‘Ÿå–”ï¼Œå†çŒœä¸€æ¬¡ï¼Ÿ";
            btn = `<button class="reset-btn">é½é½ä½ æƒ³ç‘Ÿç‘Ÿå–”ï¼Œå†çŒœä¸€æ¬¡?</button>`;
          } else if (ans === "D") {
            msg = "âŒ å•µå•µå½—æ˜Ÿä¼ºå€™!!!è·Ÿæˆ‘å•µå•µ10ç§’å®Œå†çŒœä¸€æ¬¡ <3";
            btn = `<button class="reset-btn">ç½°ä½ è·Ÿæˆ‘å•µå•µå®Œå†çŒœä¸€æ¬¡ <3</button>`;
          }
          result.innerHTML = `<p>${msg}</p><img src="${gif}"><br>${btn}`;
        }
        result.querySelectorAll(".reset-btn").forEach(b => b.onclick = resetChoices);
        result.querySelectorAll(".continue-btn").forEach(b => b.onclick = showEnding);
      };
    })();
    
    // æ®µ10ï¼šçµå°¾ç‰¹æ•ˆ
    function startParticles() {
      const canvas = document.getElementById('particle-canvas');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      let width, height;
      function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
      }
      window.removeEventListener('resize', resize);
      window.addEventListener('resize', resize);
      resize();
      if (!window._particles) {
        window._particles = Array.from({ length: 30 }, () => ({
          x: Math.random() * width,
          y: Math.random() * height,
          r: Math.random() * 3 + 2,
          vx: (Math.random() - 0.5) * 0.5,
          vy: (Math.random() - 0.5) * 0.5,
          alpha: Math.random() * 0.5 + 0.3,
          color: Math.random() < 0.5 ? 'rgba(212,175,55,' : 'rgba(192,192,192,',
        }));
      }
      const particles = window._particles;
      function draw() {
        ctx.clearRect(0, 0, width, height);
        particles.forEach(p => {
          p.x += p.vx;
          p.y += p.vy;
          if (p.x < 0 || p.x > width) p.vx *= -1;
          if (p.y < 0 || p.y > height) p.vy *= -1;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
          ctx.fillStyle = p.color + p.alpha + ')';
          ctx.shadowColor = p.color + '1)';
          ctx.shadowBlur = 8;
          ctx.fill();
          ctx.closePath();
        });
        requestAnimationFrame(draw);
      }
      draw();
    }
    // âœ… å¼·åˆ¶è§¸ç™¼æˆ¿é–“æ®µè½åˆå§‹åŒ–
function jumpTo(id) {
  const ids = [
    'cover-check','intro','portrait','tinder','roomstory','bridge',
    'adventure','highlights','alien-test','ending'
  ];
  ids.forEach(sec => {
    const el = document.getElementById(sec);
    if (el) el.style.display = 'none';
  });
  const target = document.getElementById(id);
  if (target) {
    if ([
      'intro','bridge','highlights','roomstory','adventure','ending'
    ].includes(id)) {
      target.style.display = 'flex';
    } else {
      target.style.display = 'block';
    }
    // âœ… åŠ å…¥æ®µè½åˆå§‹åŒ–ï¼ˆå¦‚æœæ˜¯ roomstoryï¼‰
    if (id === 'roomstory') {
      setupRoomStoryManualSwitching();
    }
    if (id === 'ending') setTimeout(startParticles, 200);
  }
}

// âœ… æ–°å¢ reset æ©Ÿåˆ¶
function resetToCover() {
  console.log("resetToCover è¢«å‘¼å«");
    alert("é‡æ–°é–‹å§‹æ—…ç¨‹å›‰ï½");

  // é¡¯ç¤ºæ—¥æœŸæ®µè½ï¼Œéš±è—å…¶ä»–æ®µè½
  const ids = [
    'intro','portrait','tinder','roomstory','bridge',
    'adventure','highlights','alien-test','ending'
  ];
  ids.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.display = 'none';
  });
  document.getElementById("cover-check").style.display = "block";

  // âœ… æ—¥æœŸæ¬„ä½æ¸…ç©º
  ["year", "month", "day"].forEach(id => {
    const input = document.getElementById(id);
    if (input) input.value = "";
  });

  // âœ… æ‰“å­—å‹•ç•«æ¸…ç©º
  for (let i = 1; i <= 5; i++) {
    document.getElementById("line" + i).textContent = "";
  }
  document.getElementById("caret").style.display = "inline-block";
  document.getElementById("next-intro-btn").style.display = "none";

  // âœ… AKA åˆå§‹ç‹€æ…‹
  document.querySelectorAll(".aka").forEach(el => el.classList.remove("visible"));
  document.getElementById("next-portrait-btn").style.display = "none";

  // âœ… Tinder é‡è¨­
  const card = document.getElementById("card");
  const result = document.getElementById("swipe-result");
  const nextBtn = document.getElementById("next-tinder-btn");
  card.style.opacity = 1;
  card.style.transform = "";
  result.innerHTML = "";
  result.classList.remove("visible");
  nextBtn.style.display = "none";

  const hintOverlay = document.querySelector(".swipe-hint-overlay");
  if (hintOverlay) hintOverlay.style.display = "block";

  // âœ… æˆ¿é–“æ®µè½é‡çµ„
  if (typeof setupRoomStoryManualSwitching === "function") {
    setupRoomStoryManualSwitching();
  }

  // âœ… å°å†’éšªæ®µè½åˆå§‹åŒ–ï¼ˆå¼·åˆ¶é‡æ–° renderï¼‰
  if (typeof render === "function") {
    render("start");
  }

  // âœ… ç¿»ç‰Œå¡ç‰‡é‡è¨­
  document.querySelectorAll('.flip-card').forEach(c => c.classList.remove('flipped'));
  document.getElementById("highlights-next-btn").style.display = "inline-block";

  // âœ… èœ¥èœ´äººæ®µè½é‡è¨­
  document.getElementById("alien-choices").style.display = "flex";
  document.getElementById("alien-result").innerHTML = "";

  // âœ… çµå°¾ç•«é¢é—œé–‰ç²’å­
  document.getElementById("particle-canvas").getContext("2d").clearRect(0, 0, window.innerWidth, window.innerHeight);
}

document.getElementById("restart-btn").onclick = resetToCover;
  });
  
</script>
</body>
</html>